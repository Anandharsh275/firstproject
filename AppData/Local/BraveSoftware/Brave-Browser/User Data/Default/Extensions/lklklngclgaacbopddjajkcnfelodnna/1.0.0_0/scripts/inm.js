!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var i in r)("object"==typeof exports?exports:e)[i]=r[i]}}(self,(function(){return(()=>{var e=e||null,t="",r="";function i(e){var t=e||document.URL;if(null==t||t.length<=0)return null;var r;if(/instagram.com\/(p|reel)\//i.test(t)&&(r=t.split("/")).length>=6)return r[4];if(/instagram.com\/.*\/(p|tv)\//i.test(t)&&((r=t.split("/")).length>=7&&"p"==r[4]))return r[5];return null}function a(r,a){if(!t){t=a,vbase.setParseMsg(10,20,"Start Analytics");i(r);vbase.setParseMsg(20,60,"Get Video Info"),r=r.replace("/reel/","/p/"),e=r;try{vbase.setParseMsg(20,60,"Get Video Info... ...");var n=r,o="";o=window.vbrowser.httpGetCookie?window.vbrowser.httpGetCookie(e):document.cookie;-1===r.indexOf("__a=1")&&(r+=-1===r.indexOf("?")?"?__a=1":"&__a=1"),vbase.app_xhr_adv(r,n,o,"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36","get","")}catch(e){return vbase.error_default("instagram 1"),null}}}function n(e,t,r){var i=t.image_versions2.candidates;e.picture_big=i[0].url;var a=i.find((e=>480===e.width||640===e.width));a||(a=i[0]),e.picture_default=a.url;var n=new video_file;1===r?(n.url=i[0].url,n.thumbnail=a.url,n.format="jpg",n.title=`${i[0].width}x${i[0].height}`,n.f_id=e.id,n.type="image",e.files.push(n)):2===r&&(e.duration=t.video_duration,n.url=t.video_versions[0].url,n.thumbnail=a.url,n.duration=t.video_duration,n.format="mp4",n.title="720p",n.f_id=t.id,n.type="video",e.files.push(n))}function o(){for(var e=document.getElementsByTagName("img"),t=0;t<e.length;++t){var r=e[t],i=r.parentNode.parentNode.parentNode,a=r.getAttribute("srcset"),n=r.getAttribute("class"),o=i.getElementsByTagName("video");if(n)if(!(null==a&&o.length<=0&&"FFVAD"!=n))if(!n||-1===n.indexOf("s4Iyt"))-1==i.parentNode.innerHTML.indexOf("/p/")&&l(i)}var s=document.querySelectorAll("._97aPb");for(let e=0;e<s.length;e++){i=s[e];i.querySelector("video")&&l(i)}}function l(e){if(-1==e.innerHTML.indexOf('class="download"')){var t=document.createElement("div");t.className="download",t.addEventListener("click",d,!1),t.style.cssText=`position: absolute;z-index: 99999; bottom: 6px; right: 4px; background: ${vbase.download_btn_color}; width: 54px; height:54px; border-radius: 50%;cursor: pointer;`,t.innerHTML=`<img width='100%' height='100%' src='${vbase.download_btn_icon}'/>`,e.appendChild(t)}}window.video_analytics=function(e){if(!e)return t="",vbase.error_default("vm_content is empty"),null;try{e=JSON.parse(e);var r="",i=new video;if(i.check_type="instagram",i.js_ver="4.01",i.js_info="20190523",e.hasOwnProperty("graphql")){var a=(f=e.graphql.shortcode_media).__typename;i.id=f.id;try{r=f.edge_media_to_caption.edges.length>0?f.edge_media_to_caption.edges[0].node.text:"instagram"}catch(e){r="instagram"}i.picture_big=f.display_url;var o=new video_file;if("GraphImage"===a)i.picture_default=f.display_resources[0].src,o.url=f.display_url,o.thumbnail=f.display_resources[0].src,o.format="jpg",o.title="1080x1080",o.f_id=i.id,o.type="image",i.files.push(o);else if("GraphVideo"===a)i.picture_default=f.display_resources[0].src,i.duration=f.video_duration,(o=new video_file).url=f.video_url,o.thumbnail=f.display_resources[0].src,o.duration=f.video_duration,o.format="mp4",o.title="720p",o.f_id=f.id,o.type="video",i.files.push(o);else if("GraphSidecar"===a&&(i.picture_default=f.display_resources[0].src,f.edge_sidecar_to_children&&f.edge_sidecar_to_children.edges&&f.edge_sidecar_to_children.edges.length>0))for(let e=0;e<f.edge_sidecar_to_children.edges.length;e++){const t=f.edge_sidecar_to_children.edges[e].node;if((o=new video_file).url=t.is_video?t.video_url:t.display_url,o.thumbnail=t.display_resources[0].src,t.is_video){var l=t.dash_info.video_dash_manifest.match(/mediaPresentationDuration.*?PT(.*?S)/);if(null!==l){var s=l[1];if(null!==s.match(/(\d*)H(\d*)M(.*?)S/)){var d=parseInt(s.match(/(\d*)H(\d*)M(.*?)S/)[1]),u=parseInt(s.match(/(\d*)H(\d*)M(.*?)S/)[2]),c=parseFloat(s.match(/(\d*)H(\d*)M(.*?)S/)[3]);o.duration=60*d*60+60*u+c}}}o.format=t.is_video?"mp4":"jpg",o.title=t.is_video?"720p":"1080x1080",o.f_id=t.id,o.type=t.is_video?"video":"image",i.files.push(o)}if(f.owner)(p=new video_author).id=f.owner.id,p.avatar=f.owner.profile_pic_url,p.username=f.owner.username,p.full_name=f.owner.full_name,p.url=`https://www.instagram.com/${f.owner.username}/`,i.author=p}else if(e.hasOwnProperty("items")&&e.items.length>0){var f,p;a=(f=e.items[0]).media_type;i.id=f.id;try{r=f.caption.text}catch(e){r="instagram"}if(1===a||2===a)n(i,f,a);else if(8===a&&f.carousel_media&&f.carousel_media.length>0)for(let e=0;e<f.carousel_media.length;e++){const t=f.carousel_media[e];n(i,t,t.media_type)}if(f.user)(p=new video_author).id=f.user.pk,p.avatar=f.user.profile_pic_url,p.username=f.user.username,p.full_name=f.user.full_name,p.url=`https://www.instagram.com/${f.user.username}/`,i.author=p}if(i.title=r,i.files.length<=0)return t="",vbase.error_default("analytics Not find  source"),null;t?(t="",window.vbrowser.popupVideoInfo(JSON.stringify(i))):(vbase.setParseMsg(100,100,"Completed"),vbase.set_videoInfo(JSON.stringify(i)))}catch(e){return t="",vbase.error_default("analytics Not find  source"),null}};var s="";function d(){if(""!=(s=event.target)){var e=s.parentNode;e&&"download"==e.className&&function(){if(!1,""!=s){var e="",t="",r="",i="",n=null,o=!0,l=s.parentNode.parentNode,d=l.innerHTML,u="mp4",c="video",f="720p",p=l.getElementsByClassName("FFVAD");for(0===p.length&&-1===d.indexOf(".mp4")&&(p=l.querySelectorAll("img.y-yJ5")),p.length>0&&(c="image",u="jpg",f="1080x1080",(r=p[0].getAttribute("src"))&&(e=r,i=(N=r.split("/"))[N.length-1].split("?")[0],-1===d.indexOf(".mp4")&&(o=!1)));1==o&&"DIV"==l.tagName&&-1!=d.indexOf(".mp4");){var m=l.getElementsByTagName("video");if(m.length>0){var g=m[0];g.pause();var _=g.getAttribute("src");if(!_){var v=g.getElementsByTagName("source");v.length>0&&(_=(v=v[0]).getAttribute("src"))}null!=_&&null!=_&&(e=_);var h=g.getAttribute("poster");if(null!=h&&null!=h&&-1===h.indexOf("base64")&&(r=h),!r){var y=l.querySelector("img.y-yJ5");y&&y.getAttribute("src")&&(r=y.getAttribute("src"))}e.length>0&&(N=e.split("/")).length>=3&&(i=(i=(i=N[N.length-1]).split("mp4"))[0]),o=!1;break}l=l.parentNode}try{for(n=s.parentNode.parentNode;"ARTICLE"!=n.tagName&&"BODY"!=n.tagName;)if("ARTICLE"==(n=n.parentNode).tagName){var b=n.getElementsByClassName("EtaWk");if(b.length>0){var w=(b=b[0]).getElementsByClassName("_8Pl3R");w.length>0&&(w=(w=w[0]).getElementsByTagName("span")).length>0&&(t=(w=w[0]).innerText)}break}}catch(e){}if(!e||e.length<10){var N,x=l.getElementsByTagName("video");x&&(e=x[0].src,r=x[0].poster),e.length>0&&(N=e.split("/")).length>=3&&(i=(i=N[N.length-1]).replace(".mp4",""))}if(e&&-1!==e.indexOf("blob:")||null!==n.querySelector(".vi798")){var O=n.getElementsByClassName("c-Yi7");if(O.length>0){var A=(O=O[0]).getAttribute("href");if(A)return void a(A=location.origin+A+"?__a=1","local")}}if(!(e.length>0))return vbase.error_default("Pop  Not find  source"),null;t||(t="Instagram");var S=new video;S.check_type="instagram",S.js_ver="4.01",S.js_info="20190523:add image",S.title=t,S.picture_default=r,S.picture_big=r,S.id=i,S.url=document.url;var T=new video_file;T.url=e,T.f_id=S.id+"_1",T.format=u,T.title=f,T.type=c,T.thumbnail=r,S.files.push(T);try{window.vbrowser.popupVideoInfo(JSON.stringify(S))}catch(e){return vbase.error_default("Pop info error"),null}}}()}}return window.startObserver=function(){var e;o(),e=document,(r=new MutationObserver((function(e){o()}))).observe(e,{childList:!0,subtree:!0})},window.removeObserver=function(){r&&r.disconnect(),document.querySelectorAll("div.download").forEach((e=>{e.remove()}))},{}})()}));